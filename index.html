<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì…ì§€ í‰ê°€ ìë™í™” ì‹œìŠ¤í…œ</title>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=e978f9c48f502b3294788dcf7b3b67f0&libraries=services"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; background: #f4f4f4; }
    h1 { color: #2b6cb0; }
    #map { width: 100%; height: 400px; margin-top: 20px; }
    .result { margin-top: 20px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    input, button { padding: 8px; font-size: 16px; margin: 5px 0; }
    .chart-container { width: 400px; margin-top: 30px; }
  </style>
</head>
<body>
  <h1>ì‹ ê·œ ê±´ì„¤ ì‚¬ì—…ì¥ ì…ì§€ í‰ê°€ ìë™í™” ì‹œìŠ¤í…œ</h1>
  <input type="text" id="address" placeholder="ì‚¬ì—…ì¥ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" size="50">
  <button id="searchBtn">ê²€ìƒ‰</button>

  <div id="map"></div>
  <div class="result" id="scoreOutput"></div>
  <div class="chart-container">
    <canvas id="scoreChart"></canvas>
  </div>

  <script>
    window.onload = function () {
      let map;
      let marker;

      document.getElementById("searchBtn").onclick = function () {
        const address = document.getElementById("address").value;
        const geocoder = new kakao.maps.services.Geocoder();

        if (!address) {
          alert("ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }

        geocoder.addressSearch(address, function (result, status) {
          if (status !== kakao.maps.services.Status.OK) {
            alert('ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }

          const lat = parseFloat(result[0].y);
          const lng = parseFloat(result[0].x);
          const coord = new kakao.maps.LatLng(lat, lng);

          const container = document.getElementById('map');
          const options = { center: coord, level: 3 };

          if (!map) {
            map = new kakao.maps.Map(container, options);
          } else {
            map.setCenter(coord);
          }

          if (marker) marker.setMap(null);
          marker = new kakao.maps.Marker({ position: coord, map: map });

          runEvaluation(coord);
        });
      };

      function runEvaluation(coord) {
        const scores = {
          complexScale: "B",
          infraAccess: "A",
          schoolAccess: "C"
        };
        document.getElementById("scoreOutput").innerHTML = `
          <strong>ì…ì§€ í‰ê°€ ê²°ê³¼:</strong><br>
          ğŸ¢ ì£¼ê±° ë‹¨ì§€ ê·œëª¨: ${scores.complexScale}<br>
          ğŸ§ ì¸í”„ë¼ ì ‘ê·¼ì„±: ${scores.infraAccess}<br>
          ğŸ« ì´ˆë“±í•™êµ ì ‘ê·¼ì„±: ${scores.schoolAccess}
        `;

        const labels = ["ì£¼ê±°ë‹¨ì§€", "ì¸í”„ë¼", "ì´ˆë“±í•™êµ"];
        const data = [
          scoreToNumber(scores.complexScale),
          scoreToNumber(scores.infraAccess),
          scoreToNumber(scores.schoolAccess)
        ];
        drawChart(labels, data);
      }

      function scoreToNumber(score) {
        return { A: 5, B: 4, C: 3, D: 2, E: 1 }[score] || 0;
      }

      function drawChart(labels, data) {
        const ctx = document.getElementById('scoreChart');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'ì…ì§€ í‰ê°€ ì ìˆ˜',
              data: data,
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: { beginAtZero: true, max: 5 }
            }
          }
        });
      }
    };
  </script>
</body>
</html>
